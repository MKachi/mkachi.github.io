---
title: 2019년 회고
date: 2019-12-30
time: 02:11:32
tags: [회고]
---

### 할만한 클릭 미연시

작년 2018년의 회고록에도 이 게임에 관한 회고를 작성하였습니다.
올해의 회고에도 언급을 하게 된 이유는 회사에서 제 포트폴리오를 우연히 보게 된 
다른 팀 사람들이 `혹시 이 게임.... 아세요...?`라고 여쭤보시고
의외로 아직도 수익이 나오고 있어서 언급을 하게 되었습니다...

또한 맥심 (그 맥심 맞음...)에 게임이 소개되는 희한한 상황이 벌어지기도 했습니다.

<img src="https://i.imgur.com/TK25lOj.png" alt="image-20191228174813669" style="zoom:50%;" />

?????!?????!??????!????????!?????!?!?!???

안녕하세요 맥심에 소개된 그 목 떨어지는 게임을 개발한 프로그래머입니다.

## 직장 생활

작년에 정말로 운이 좋아 현역 산업기능요원 TO를 받고 편입에 성공하였습니다.
회사에서 작업한 업무들을 되돌아볼까 합니다.

### 업무

입사하고서 가장 처음에 인수 인계받은 일은 어느 대학병원의 유지보수였습니다.
병원의 전산은 보통 `HIS(Hospital Information System)` 의료 정보 시스템이라고 말합니다.

의료 정보 시스템은 다음과 같은 여러 요소를 포함합니다.

* `EMR(Electronic Medical Record)` : 전자 의료 기록
* `OCS(Order Communication System)` : 처방 전달 시스템
* `PACS(Picture Archiving and Communication System)` : 의료 영상 저장 전송 시스템
* `PIS(Pharmacy Information System)` : 약국 정보 시스템
* `NIS(Nursing Information System)` : 간호 정보 시스템 (국정원 아님 ㅎ....)
* `FIS(Finance Information System)` : 재무 관리 시스템
* `CIS(Clinical Information System)` : 임상 정보 시스템
* `LIS(Laboratory Information System)` : 연구실 정보 시스템
* `RIS(Radiology Information System)` : 방사선과 정보 시스템
* `WAMIS(Wide Area Medical Information System)` : 광역 의료 정보 시스템

이 중에  맡고 있는 부분은 `LIS(Laboratory Information System)`의 Interface부분입니다.

`LIS Interface`는 다음과 같은 역할을 수행합니다.

진단검사의학과에서 임상병리사 선생님들이 `검체(환자의 혈액, 소변, 체액, 조직 등)`에 `EMR(Electronic Medical Record)`에 입력한 `Code128`로 만들어진 바코드를 붙여 장비에서 찍게 되면

`OCS(Order Communication System)`에 입력된 `Order`정보를 가져와 장비로 명령을 전달하고 결과를 받아 `EMR(Electronic Medical Record)`에 전달합니다.

하지만 병원의 전산 시스템은 표준화가 이루어져 있지 않아 
전부 제각각으로 구성이 되어 있고 의료 장비 또한 그렇습니다.
`ISO`에서는 `HL7`이라는 형식을 표준 방식으로 밀고 있지만 `HL7`을 사용한다 해도

결국 장비 회사의 입맛대로 변경이 되어 있는 `HL7`데이터 형식인 경우가 많았습니다.

#### APTIO Interface의 성능 개선

`LIS Interface`를 유지보수 하던 중 가장 기억에 남는 것은 `APTIO`라고 하는 `TLA(Total Laboratory Automation)`형식의 장비입니다.
`TLA(Total Laboratory Automation)`는 진단검사의학과에서 부분적으로 이루어졌던 자동분석시스템을 검체 채혈부터 결과 보고까지 모든 과정을 자동화한 시스템입니다.

`APTIO`는 하루 평균 8,000개의 검사 항목을 주고받는데 이 중 3~6개의 검사가 하나의 검체에 묶여 전송됩니다.
이러한 검체 하나의 결과를 전송하는데 20~30초 정도의 시간이 소요됩니다.

단순히 검체 하나만 본다면 그렇게 오래 걸리진 않지만 한 번 검사가 들어오면 10~30개의 검체가 한 번에 들어오게 됩니다.

검사가 완료되었다면 결과가 바로바로 `EMR(Electronic Medical Record)`로 전달이 되어야 하는데
이 시간이 오래 걸려 개선을 요청하신 것입니다.

##### 문제점

`APTIO`의 `Interface`에는 다음과 같은 문제점이 있었다.

* `불포화철결합능(UIBC : Unsaturated Iron Binding Capacity)`을 계산해야 합니다.  
   `총철결합능(TIBC : Total Iron Binding Capacity)`와 `혈청 철(Serum Iron)`을 
  `UIBC = TIBC - Iron`과 같은 계산식으로 계산하여 전송해야 합니다.
  보통 `Server`에서 `Transaction`으로 계산되는 식이지만 `UIBC(UIBC : Unsturated Iron Binding Capacity)`의 경우 `Interface`에서 계산하기로 협의가 된 상황이었습니다.
  하지만 두 검사의 결과값이 언제 들어올지는 모릅니다.
* 검사 결과 데이터가 가끔 누락됩니다.  
  데이터가 가끔 누락되어 임상병리사 선생님께서 수기로 입력하고 계셨습니다.
* 전송 속도가 상당히 오래 걸립니다.  
  검사 결과가 나오게 되면 바로 `EMR(Electronic Medical Record)`로 넘어가야 하는데 
  이 과정에 약 6초가 소요되고 검체가 100개씩 몰리게 되면 약 600초가 소요됩니다.
  일단 기다리면 될 것 같지만 대기 시간이 길어지다 보니 산사태처럼 한 번에 몰려 최장 10시간이 소요된다는 결과가 나온 적도 있습니다. (이때는 일정 부분을 수기로 작성하여 넘기셨습니다.)

##### 해결

* 검사 결과 데이터가 가끔 누락됩니다.  
  `불포화철결합능(UIBC : Unsturated Iron Binding Capacity)`를 계산하기 위해 `총철결합능(TIBC : Total Iron Binding Capacity)`와 `혈청 철(Serum Iron)`의 값 중 하나라도 들어오지 않을 경우 
  값을 전달하지 않고 남은 값이 들어올 때까지 해당 검체의 데이터를 메모리에 지니고 있습니다.

  이후 남은 검사 결과값이 들어올 때 처리가 잘못되어 데이터를 전송시키지 않고 있었다.
  관련 처리를 정상적으로 수정하였습니다.

* 전송 속도가 상당히 오래 걸립니다.  
  많은 양의 검사 항목을 검체 번호순으로 묶은 뒤 데이터를 한 번에 요청하고 있었습니다.
  `APTIO`의 특성상 요청 횟수의 최적화보다 빠른 결과 보고가 우선시 됩니다.
  검사 항목별로 데이터를 전송하도록 수정하였습니다.

##### 결과

결과적으로 검사 데이터를 넘기는 속도가 개선되었습니다.
기존 검사 처리 (100,000개) : 약 60,000초 (16시간 40분)
개선 후 검사 처리 (100,000개) : 약 6,000초 (1시간 40분)

개선된 `Interface`가 적용된 7월 15일로부터 이 글을 작성하는 날짜인 12월 30일 기준으로 
869,559개의 검사가 진행되었습니다.
즉 약 521,735초(144시간 55분 35초)의 시간을 절약하였습니다.

응급 환자들의 검체 또한 `TLA(Total Laboratory Automation)`를 이용하기 때문에
더욱 많은 응급 환자들에게 빠른 조치를 취할 수 있었을 것이라고 생각합니다.

이 이외에도 많은 양의 `Interface`를 개발, 유지 보수를 하였습니다.

![image-20191230012705444](https://i.imgur.com/LOGkfax.png)

### 소스 코드의 관리

처음 인수인계 설명을 들을 때 소스 코드는 `SVN`으로 관리 되고 있다고 하였습니다.
하지만 제대로 사용하고 있는 것이 아닌 웹하드에 소스를 백업하는 정도로 사용하고 있었습니다.

게다가 `SVN`조차 사용하지 않고 있는 프로젝트가 다수 있었고 작업을 하고서도 `commit`을 하지 않아
최신 본으로 소스 코드가 유지되지 않는 경우가 많았습니다.

몇 개의 프로젝트가 랜섬웨어에 걸려서 프로젝트의 많은 변경사항을 다시 작업하는 때도 많았습니다.
아직은 정말 크게 문제 될만한 상황이 없었던 거 같지만 

계속 이런 식으로 진행되다간 큰일 나겠다는 생각이 들어 우선 우리 팀에서만이라도 형상 관리가 제대로 되도록 `Git`을 도입하고
후임들에게 자료를 주고 교육을 진행하였습니다.

![image-20191228142230940](https://i.imgur.com/OpVUeFF.png)

작업하는 프로젝트의 특성상 어딘가에 소스를 위탁하여 관리하면 안 되어 회사 컴퓨터를 하나 지급받아
`CentOS`에 `GitLab`을 설치하여 사용하고 있습니다.

## 2019년을 마무리하며

올해에는 처음으로 직장에 다니면서 많이 힘들었습니다.
주변에서 기피하는 `SI`회사에 입사하면서 어째서 기피하는지도 알게 되었습니다.

#### 2019년 힘들었던 일

* 프로그램의 A/S 전화를 직접 받아 안내해야 합니다.  
  전화를 받아 문제점을 정확하게 잡아주시면 좋겠지만 임상병리사 선생님들은 단순히 사용자의 입장이십니다.
  그렇다 보니 단순히 안된다고만 하시는 경우도 많고 갑자기 화를 내시기도 합니다.
  또한 병원이나 장비업체 간의 정치적인 사항들도 끼어있어 많이 힘들었습니다.
* 인수인계를 제대로 받지 못했습니다.  
  소스 코드의 대부분이 하드 코딩되어 있고 문제가 있는 부분도 많았습니다.
  게다가 인수인계 교육을 받던 시점이 전임자분께서 퇴사하기 직전이었습니다.
  도메인 지식 또한 많이 부족하여 익숙해지기까지 시간이 걸렸습니다.
* 생활 패턴이 바뀌어 적응하기가 힘들었습니다.  
  처음으로 직장에 다니게 되면서 아침 일찍 출근하고 늦게 퇴근을 하는 패턴에 적응하기 힘들었습니다.
  퇴근을 하고 나면 체력이 고갈되어 개인 공부를 하기도 전에 기절해버리는 날이 많이 있었습니다.
  결국 주말에는 거의 누워지내는 날이 많이 있었습니다.

#### 2019년에 얻은 것들

* 사람을 대하는 방법  
  사람을 대하기가 많이 어려웠었는데 회사에 다니고 여러 고객과 접해보며 많이 개선된 것 같습니다.
* 병원의 도메인 지식이 늘었다.  
  병원의 업무 프로세스나 검사 항목들 같은 도메인 지식이 늘었습니다.
  재미있는 일로 한창 A형 간염이 유행 중일 때 저도 혹시나 해서 항체 검사를 받았었습니다.
  그때 병원에서 받은 검사 결과 용지의 수치만 보고 선생님께 "아 다행히 전 항체가 있네요" 라고 말했더니
  선생님 : ???? 어떻게 아셨어요?
  이런 일이 있었습니다 ㅋㅋ

#### 2020년의 목표

* 생활 패턴에 적응하자  
  결국 회사에 다니게 된다면 적응해야 합니다.
* 이직을 준비하자  
  만약 병원과 관련된 일을 한다면 지금의 회사는 정말 좋은 회사라고 생각합니다.
  저는 원래 게임 클라이언트 프로그래머가 되고 싶었습니다.
  하지만 저는 이 회사에 다니면서 사용자가 사용하는 프로그램을 만드는 것에 더 흥미를 느껴
  서비스 쪽 분야로 진로를 바꿔볼까 합니다.
* `GitHub`를 다시 많이 사용하자  
  회사에 `GitLab`을 구축하여 사용하게 되니 작업 내용이 모두 `GitLab`에 기록이 남이 있습니다.
  이렇다 보니 `GitHub`의 `Commit`그래프에 탈모가 가속화되고 있습니다.
  다시 머리카락을 심어야 할 것 같습니다.
* 블로그를 완성하자  
  고등학교에 다닐 때는 블로그 글을 작성하는 것 또한 재미있었고 공부한 것들을 정리할 수 있어
  공부에 많은 도움이 됐습니다. 하지만 대학에 입학하고 나서는 블로그를 Github Page로 옮기고 싶어
  프로젝트를 만들어 작업 중이었지만 계속 보류 중에 있었습니다.
  2020년의 2월 전까지는 완성하여 기존 블로그의 포스트들을 옮겨 놓고 새롭게 글을 작성하고 싶습니다.